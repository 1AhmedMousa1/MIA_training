# Task6-2

# Encoder Reading with Interrupts

## Hardware Setup

The following hardware components are required for this project:

- Arduino board (e.g., Arduino Uno)
- Rotary encoder with two output pins (A and B)
- Jumper wires

Connect the hardware as follows:

1. Connect the encoder pin A to digital pin 2 (PinA).
2. Connect the encoder pin B to digital pin 3 (PinB).
3. Connect the common ground of the encoder to the Arduino's ground (GND).
4. Provide power to the encoder (e.g., 5V and GND from the Arduino board).

## Understanding the Code

The code consists of the following parts:

1. Pin Definitions: The pin numbers for the encoder pins (A and B) are defined using `#define` statements.
2. Counter Variable: A `counter` variable is declared to hold the current position of the encoder. It is declared as `volatile` to indicate that it may be modified by an interrupt handler.
3. Setup Function: The `setup` function initializes the serial communication, configures the encoder pins as inputs with pull-up resistors, and attaches the interrupt service routines to the corresponding pins.
4. Loop Function: The `loop` function prints the current position of the encoder every 100 milliseconds using the serial communication.
5. Encoder A ISR: This ISR is triggered when there is a change in the state of PinA. Depending on the states of PinA and PinB, the `counter` variable is incremented or decremented.
6. Encoder B ISR: This ISR is triggered when there is a change in the state of PinB. Depending on the states of PinB and PinA, the `counter` variable is incremented or decremented.

# Code

```c
#define PinA 2
#define PinB 3

volatile long counter = 0;

void setup() {
  Serial.begin(9600);
  pinMode(PinA, INPUT_PULLUP);
  pinMode(PinB, INPUT_PULLUP);

  // Attach interrupts to the encoder pins
  attachInterrupt(digitalPinToInterrupt(PinA), encoderA_ISR, CHANGE);
  attachInterrupt(digitalPinToInterrupt(PinB), encoderB_ISR, CHANGE);
}

void loop() {
 
  static unsigned long lastPrintTime = 0;
  if (millis() - lastPrintTime >= 100) {
    Serial.println(counter);
    lastPrintTime = millis();
  }
}

void encoderA_ISR() {
  // Check the state of PinA
  if (digitalRead(PinA) == LOW) {
    // PinA is LOW
    if (digitalRead(PinB) == LOW) {
      // PinB is also LOW, clockwise rotation
      counter++;
    } else {
      // PinB is HIGH, counter-clockwise rotation
      counter--;
    }
  } else {
    // PinA is HIGH
    if (digitalRead(PinB) == LOW) {
      // PinB is LOW, counter-clockwise rotation
      counter--;
    } else {
      // PinB is HIGH, clockwise rotation
      counter++;
    }
  }
}

void encoderB_ISR() {
  // Check the state of PinB
  if (digitalRead(PinB) == LOW) {
    // PinB is LOW
    if (digitalRead(PinA) == LOW) {
      // PinA is also LOW, counter-clockwise rotation
      counter--;
    } else {
      // PinA is HIGH, clockwise rotation
      counter++;
    }
  } else {
    // PinB is HIGH
    if (digitalRead(PinA) == LOW) {
      // PinA is LOW, clockwise rotation
      counter++;
    } else {
      // PinA is HIGH, counter-clockwise rotation
      counter--;
    }
  }
}
```

## Notes

I used wowki to test this code so output maybe varries for real ardiuno board

---

---

# The question

We need to design a Software Practical Low Pass Filter (LPF) what is the proper cutoff frequency (fc) If WALL-E has Specs:

 

- Encoder has 540 pulse per revolution
- Track has three wheels only one motorized, with 40cm diameter, (The one that has encoder)
- And Maximum speed of WALL-E 0.5 m/s

# Answer:

To determine the proper cutoff frequency (fc) for the software practical low pass filter (LPF)  we'll need to consider the encoder's pulse count, the track's wheel diameter, and the maximum speed.

1. Calculate the Encoder's Pulses per Meter:
    - The encoder has 540 pulses per revolution.
    - We need to determine the distance traveled per revolution to calculate the pulses per meter.
    - The circumference of a circle is given by  $C = 2πr$, where r is the radius.
    - In this case, the radius is half the diameter, so
    - $r = 40 cm/2 = 20 cm = 0.2 m$.
    - Therefore, the distance traveled per revolution is
    - $D = C = 2πr = 2π * 0.2 m ≈ 1.26 m.$
    - The number of pulses per meter is then
    - $540 pulses / 1.26 m ≈ 428.57 pulses/m.$
2. Determine the Maximum Frequency of the Encoder Signal:
    - The maximum frequency of the encoder signal is determined by the maximum speed.
    - Given that the maximum speed is 0.5 m/s, the encoder will produce a maximum frequency when the is moving at this speed.
    - Therefore, the maximum frequency of the encoder signal is the product of the maximum speed and the pulses per meter:
    - $0.5 m/s * 428.57 pulses/m ≈ 214.29 Hz$.
3. determining the Cutoff Frequency for the Low Pass Filter:
    - In this case, we can choose a cutoff frequency of 1/10 of the maximum encoder signal frequency, which is approximately
    - $214.29 Hz / 10 ≈ 21.43 Hz.$

**Therefore, for a low pass filter (LPF) the cutoff freq would be around $21.43 Hz.$**